# 模块化

## 为什么需要模块化

在不断增长的代码库中，可扩展性、可读性和整体代码质量往往会随着时间的推移而下降。这是因为代码库的规模不断扩大，而维护者却没有采取积极措施来强化易于维护的结构。模块化是一种结构化代码库的方法，它能提高可维护性并有助于避免这些问题。

## 模块化的收益

* 提升代码的可复用性
* 提升代码的可测试性（模块化后模块间耦合度低）
* 提升代码的可扩展性（模块化后模块间耦合度低）
* 提升构建性能（好的模块化可充分利用Gradle的增量构建、构建缓存、并行构建等能力）
* 更方便的控制代码的可见性
* 更方便的进行代码封装
* 更方便的项目管理（一个模块指定一个负责人）

## 常见陷阱

* 模块化粒度过细
* 模块化粒度过大
* 模块之间引用过于复杂

当设计模块化代码库时，需要考虑模块粒度及相对复杂性，粒度过细会让模块化成为一个负担，粒度过大会降低模块化的收益，模块之间引用过于复杂同样也会降低模块化的收益。

## 模块化设计原则

### 模块内高内聚，模块间低耦合

### 对外尽可能少暴露，对外尽量暴露接口，使用依赖注入暴露接口，对外不暴露接口实现类

### 尽量是与 Android 无关的 Java 或 Kotlin 模块

## 模块化方案

按照功能来划分模块

```kt
app
⬇️
feature
```

分层架构，数据层复用

```kt
app
⬇️
feature
⬇️
feature-data
```

业务通用逻辑下沉

```kt
app
⬇️
feature
⬇️
feature-data
⬇️
core
```

业务无关通用逻辑再下沉

```kt
app
⬇️
feature
⬇️
feature-data
⬇️
core
⬇️
base
```

最终方案

![Modularization](/Android/Modularization/assets/modularization.drawio.png)
